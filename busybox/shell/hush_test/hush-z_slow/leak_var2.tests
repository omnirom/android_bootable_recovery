echo "Warm up"
t=1
export t
i=1
while test $i != X; do
    t=111111111111111111111111111111111111111111111111111111111111111111111110$i
    t=111111111111111111111111111111111111111111111111111111111111111111111111$i true
    t=111111111111111111111111111111111111111111111111111111111111111111111112$i /bin/true
    t=111111111111111111111111111111111111111111111111111111111111111111111113$i exec 1>&1
    i=1$i
    if test $i = 1111111111111111111111111111111111111111111111; then i=2; fi
    if test $i = 1111111111111111111111111111111111111111111112; then i=3; fi
    if test $i = 1111111111111111111111111111111111111111111113; then i=4; fi
    if test $i = 1111111111111111111111111111111111111111111114; then i=X; fi
done
unset t i

memleak

echo "Measuring memory leak..."
t=1
export t
i=1
while test $i != X; do
    t=111111111111111111111111111111111111111111111111111111111111111111111110$i
    t=111111111111111111111111111111111111111111111111111111111111111111111111$i true
    t=111111111111111111111111111111111111111111111111111111111111111111111112$i /bin/true
    t=111111111111111111111111111111111111111111111111111111111111111111111113$i exec 1>&1
    i=1$i
    if test $i = 1111111111111111111111111111111111111111111111; then i=2; fi
    if test $i = 1111111111111111111111111111111111111111111112; then i=3; fi
    if test $i = 1111111111111111111111111111111111111111111113; then i=4; fi
    if test $i = 1111111111111111111111111111111111111111111114; then i=X; fi
done
unset t i

memleak
kb=$?
if test $kb -le 4; then
    echo Ok
else
    echo "Bad: $kb kb (or more) leaked"
fi
